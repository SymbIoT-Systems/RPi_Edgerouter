<!DOCTYPE html>
<html lang="en">
	<head>
		<h1>Database Management</h1>
		
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	

	<script>
	var jsondata;

		function editclick(name){
			$("#editform").show();
			$('#edit_idno').val(name);
			$('#edit_nodeid').val(jsondata[name-1][1]);
			$('#edit_dev_id').val(jsondata[name-1][2]);
			$('#edit_nodetype').val(jsondata[name-1][3]);
			$('#edit_nodeprop').val(jsondata[name-1][4]);
		}

	$(document).ready(function(){
		$("#editform").hide();
		
		function getnodedata(){
			$.post('/data_get/',{data:'nodesdata'},function(result,status){
				// alert(result);
				jsondata=$.parseJSON(result);
				// alert(jsondata.length);
				var html = '<table style="width:100%"><tr><td>Node No.</td><td>Device ID.</td><td>Node Type</td><td>Properties</td>			<td>Battery Status</td><td>Edit</td></tr>';
				for (var i=0;i<jsondata.length;i++){
					html+='<tr>';
					for (var j=1;j<6;j++){
						html+='<td>'+jsondata[i][j]+'</td>';
					}
					html+='<td><button onclick="editclick('+jsondata[i][0]+');">Edit</button></td></tr>';

				}
				html+='</table>';
    			$("#nodesdata").html(html);

			});
		}

		function getcluserdata(){
			$.post('/data_get/',{data:'clustersdata'},function(result,status){
				// alert(result);
				jsondata=$.parseJSON(result);
				// alert(jsondata.length);
				var html = '<table style="width:100%"><tr><td>Cluster No.</td><td>Cluster Head No.</td><td>ClusterHead Device ID</td><td>List of Nodes</td><td>Gateway MAC</td><td>Gateway IP</td><td>Code Details Slot 1</td><td>Code Details Slot 2</td><td>Code Details Slot 3</td></tr>';
				for (var i=0;i<jsondata.length;i++){
					html+='<tr>';
					for (var j=1;j<6;j++){
						html+='<td>'+jsondata[i][j]+'</td>';
					}
					html+='<td><button onclick="editclick('+jsondata[i][0]+');">Edit</button></td></tr>';

				}
				html+='</table>';
    			$("#clustersdata").html(html);

			});
		}

	getnodedata();
	getcluserdata();

	$("#data_add_form").submit(function(event) {

	/* stop form from submitting normally */
	event.preventDefault();
	/* get some values from elements on the page: */
	var $form = $( this ),
	url = $form.attr('action');
	/* Send the data using post */
	$.post( url, { nodeid: $('#nodeid').val(),
	dev_id: $('#dev_id').val(),
	nodetype: $('#nodetype').val(),
	nodeprop: $('#nodeprop').val()
	},function(result,status){
		$('#nodeid').val('');
		$('#dev_id').val('');
		$('#nodetype').val('');
		$('#nodeprop').val('');
		getnodedata();
	});
    
    });

    $("#data_edit_form").submit(function(event) {

	/* stop form from submitting normally */
	event.preventDefault();
	/* get some values from elements on the page: */
	var $form = $( this ),
	url = $form.attr('action');
	/* Send the data using post */
	$.post( url, { 
	idno:  $('#edit_idno').val(),
	nodeid: $('#edit_nodeid').val(),
	dev_id: $('#edit_dev_id').val(),
	nodetype: $('#edit_nodetype').val(),
	nodeprop: $('#edit_nodeprop').val()
	},function(result,status){
		$('#edit_nodeid').val('');
		$('#edit_dev_id').val('');
		$('#edit_nodetype').val('');
		$('#edit_nodeprop').val('');
		$('#editform').hide();
		getnodedata();
	});
    
    });
});
	</script>
	</head>

	<body>
		<h1>NODES FORM</h1>
		<form action="/data_add/" method="post" name="data_add_form" id="data_add_form">
			Node ID: <input type="number" id="nodeid"></br>
			Device ID: <input type="number" id="dev_id"></br>
			Node Type: <input type="text" id="nodetype"></br>
			Special Properties: <input type="text" id="nodeprop"></br>

			<input type="submit" value="Submit">	
		</form>
		<h1>CLUSTER FORM</h1>
		<form action="/data_add/" method="post" name="data_add_form" id="data_add_form">
			Cluster No: <input type="number" id="nodeid"></br>
			Cluster Head No: <input type="number" id="dev_id"></br>
			Cluster Head Device ID: <input type="text" id="nodetype"></br>
			List of Nodes: <input type="text" id="nodeprop"></br>
			Gateway MAC: <input type="text" id="nodeprop"></br>
			Gateway IP: <input type="text" id="nodeprop"></br>
			<input type="submit" value="Submit">	
		</form>

		</br>
		</br>

		<div id="nodesdata">
				
			</div>
		</br>
		<div id="clustersdata">
				
			</div>
			</br>
	</br>
		<div id="editform" name="editform" class="popup">
			
			<form action="/data_edit/" method="post" name="data_edit_form" id="data_edit_form">
			Row ID:<input type="number" id="edit_idno" disabled></br>	
			Node ID: <input type="number" id="edit_nodeid"></br>
			Device ID: <input type="number" id="edit_dev_id"></br>
			Node Type: <input type="text" id="edit_nodetype"></br>
			Special Properties: <input type="text" id="edit_nodeprop"></br>

			<input type="submit" value="Edit">	
		</form>
		</div>
	</body>
</html>